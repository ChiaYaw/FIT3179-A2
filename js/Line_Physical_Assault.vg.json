{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 500,
    "height": 281,
    "title": "Physical Assault",
    "data": {
      "url": "https://raw.githubusercontent.com/ChiaYaw/FIT3179-A2/refs/heads/main/dataset/National_4c_v1.1.csv"
    },
    "params": [
      {
        "name": "Sex_selection",
        "bind": {
          "input": "select",
          "options": [null, "Male", "Female"],
          "labels": ["All", "Male", "Female"],
          "name": "Sex: "
        }
      },
      {
        "name": "Age_selection",
        "bind": {
          "input": "select",
          "options": [null, "15-29 years", "30-44 years", "45 years and over"],
          "labels": ["All", "15-29 years", "30-44 years", "45 years and over"],
          "name": "Age Group: "
        }
      }
    ],
    "transform": [
      {"filter": "datum['Crime Type'] == 'Physical Assault'"},
      {"filter": "Sex_selection == null || datum.Sex == Sex_selection"},
      {"filter": "Age_selection == null || datum.Age == Age_selection"},
      {
        "window": [
          {"op": "mean", "field": "Victimisation Rate", "as": "mean_rate"}
        ],
        "sort": [{"field": "Victimisation Rate", "order": "descending"}]
      }
    ],
    "layer": [
      {
        "mark": {"type": "line", "point": true, "size": 1.2},
        "encoding": {
          "x": {"field": "Year", "type": "ordinal", "title": "Year"},
          "y": {
            "field": "Victimisation Rate",
            "type": "quantitative",
            "title": "Victimisation Rate (%)",
            "scale": {"domain": [0, 10]}
          },
          "detail": {"field": "Age", "type": "nominal"},
          "shape": {"field": "Age", "type": "nominal"},
          "color": {
            "field": "Sex",
            "type": "nominal",
            "scale": {"domain": ["Male", "Female"]},
            "legend": {"title": "Sex"}
          },
          "tooltip": [
            {"field": "Year", "type": "ordinal", "title": "Year:"},
            {"field": "Sex", "type": "nominal", "title": "Sex:"},
            {"field": "Age", "type": "nominal", "title": "Age:"},
            {
              "field": "Victimisation Rate",
              "type": "quantitative",
              "format": ".1f",
              "title": "Victimisation Rate (%):"
            }
          ]
        }
      },
      {
        "mark": {"type": "rule", "color": "red", "strokeDash": [3, 3]},
        "encoding": {"y": {"field": "mean_rate", "aggregate": "mean"}}
      },
      {
        "mark": {"type": "text", "align": "right", "dx": 270, "dy": -10},
        "encoding": {
          "y": {"field": "mean_rate", "aggregate": "mean"},
          "text": {"value": "Average Rate"}
        }
      }
    ]
  }